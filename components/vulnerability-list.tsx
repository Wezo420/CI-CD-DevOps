"use client"

import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { useState, useEffect } from "react"
import { Badge } from "@/components/ui/badge"
import { AlertTriangle, AlertCircle, Info } from "lucide-react"

export default function VulnerabilityList() {
  const [vulnerabilities, setVulnerabilities] = useState([])
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    const fetchVulnerabilities = async () => {
      try {
        const response = await fetch("/api/security/vulnerabilities")
        const data = await response.json()
        setVulnerabilities(data.slice(0, 10))
      } finally {
        setLoading(false)
      }
    }
    fetchVulnerabilities()
  }, [])

  const getSeverityColor = (severity: string) => {
    switch (severity) {
      case "CRITICAL":
        return "bg-red-500/20 text-red-300 border-red-500/30"
      case "HIGH":
        return "bg-orange-500/20 text-orange-300 border-orange-500/30"
      case "MEDIUM":
        return "bg-yellow-500/20 text-yellow-300 border-yellow-500/30"
      default:
        return "bg-blue-500/20 text-blue-300 border-blue-500/30"
    }
  }

  const getSeverityIcon = (severity: string) => {
    switch (severity) {
      case "CRITICAL":
      case "HIGH":
        return <AlertTriangle className="h-4 w-4" />
      case "MEDIUM":
        return <AlertCircle className="h-4 w-4" />
      default:
        return <Info className="h-4 w-4" />
    }
  }

  return (
    <Card className="bg-slate-900/50 border-slate-800">
      <CardHeader>
        <CardTitle className="text-white">Top Vulnerabilities</CardTitle>
        <CardDescription className="text-slate-400">Recent findings from security scans</CardDescription>
      </CardHeader>
      <CardContent>
        {loading ? (
          <div className="text-slate-400">Loading vulnerabilities...</div>
        ) : vulnerabilities.length === 0 ? (
          <div className="text-slate-400 text-center py-8">No vulnerabilities found</div>
        ) : (
          <div className="space-y-3">
            {vulnerabilities.map((vuln: any) => (
              <div
                key={vuln.id}
                className="p-4 border border-slate-700 rounded-lg bg-slate-800/30 hover:bg-slate-800/50 transition"
              >
                <div className="flex items-start justify-between gap-3">
                  <div className="flex items-start gap-3 flex-1">
                    {getSeverityIcon(vuln.severity)}
                    <div className="flex-1">
                      <h4 className="text-white font-medium text-sm">{vuln.title}</h4>
                      <p className="text-slate-400 text-xs mt-1">{vuln.description?.substring(0, 100)}...</p>
                      {vuln.file_path && (
                        <p className="text-slate-500 text-xs mt-2 font-mono">
                          {vuln.file_path}:{vuln.line_number}
                        </p>
                      )}
                    </div>
                  </div>
                  <Badge className={`${getSeverityColor(vuln.severity)} border`}>{vuln.severity}</Badge>
                </div>
              </div>
            ))}
          </div>
        )}
      </CardContent>
    </Card>
  )
}
